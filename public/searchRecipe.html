<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link href="stylesheets/style.css" rel="stylesheet">

</head>

<body class="background2">
  <header class="shadow-sm ">
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <ul class="nav nav-tabs">
            <li class="nav-item navbar1">
              <a class="nav-link " href="/">Sign Up</a>
            </li>
            <li class="nav-item navbar1">
              <a class="nav-link" href="/login">Log In</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#">Search Recipes</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <p class="around">Leftover Wizard</p>

  
  <div class="container background">

    <div class="row">

      <h2 class="fontwhite"> Find Recipes </h2>

    </div>

    <div class="row">
      <form>
        <div class="form-group">
          <label for="exampleInputEmail1" class="fontwhite">Type your Ingredient</label>
          <input type="input" class="form-control searchBar" id="ingridient">
        </div>
        <button type="submit" class="btn btn-primary searchRecipe button1 imgButton">Search Recipe</button>
      </form>
    </div>
    <div class="row rowIngredient">
      <!--<h2 class=" fontwhite"> RECIPE WITH 'Ingredient' </h2> -->
    </div>
    <div class="card-deck row">
      <!-- <div class="card">
        <img src="..." class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">Recipe #1</h5>
          <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional
            content. This content is a little bit longer.</p>
          <p class="card-text"> <a href="#" class="btn btn-primary">Add to my list</a></p>
        </div>
      </div> -->
    </div>
    <div class="row" id="resultDisplay">

    </div>
  </div>

</body>
<script src="./apiCalls/spoonacularAPI.js"></script>
<script src="./apiCalls/spoonAPI2.js"></script>
<!-- <script src="../views/fullRecipe.view.js"></script> -->
<script type="text/javascript">
  async function getAPIKey() {
    return await $.get("/api/spoon");
  }

  $(".searchRecipe").on("click", async function (search) {
    search.preventDefault();

    var input = $(".searchBar").val().trim();
    ingredientsArr = input.split(/[.,\/ -]/);
    ingredients = ingredientsArr.join(",+");

    // call to spoonacularAPI.js
    recipes = await SearchbyIngredientQuery(ingredients, await getAPIKey());
    // logs results of API call
    console.log(recipes);
   var title = `<h2 class=" fontwhite"> RECIPE WITH ${input} </h2>`
   $(".card-deck").append(title);
    // generate dynamic elements to display results on page
    $(".card-deck").empty();
    for (let i = 0; i < recipes.length; i++) {
      var element = `
        <div class="card card1">
            <img src="${recipes[i].image}" class="card-img-top" alt="${recipes[i].title}">
              <div class="card-body">
                <h5 class="card-title">${recipes[i].title}</h5>
                <p class="card-text"> <a href="#" class="btn btn-primary viewRecipe button1" id="${recipes[i].id}">View Full Recipe</a></p>
              </div>
          </div>
        `
      $(".card-deck").append(element);
      $(document).on("click", "a.viewRecipe", async function (event) {
        if ($(this).attr("id") == recipes[i].id) {
          event.preventDefault();
          $("#resultDisplay").empty();
          // console.log($(this));
          console.log('button ID==>>', $(this).attr("id"));
          let btnID = $(this).attr("id")
          recipe = await SearchbyRecipeID(btnID, await getAPIKey());
          console.log('recipe==>>', recipe);
          const { title, image, sourceUrl, cookingMinutes, instructions, extendedIngredients, summary } = recipe;
          const steps = extendedIngredients[0].steps;


          // obj.analyzedInstructions[0].steps[i] where I is index of the instructions
          // $("#resultDisplay").append(viewFullRecipe(recipe));
         // var element = `
         //   <div class=" jumbotron-fluid">
         //     <h2 class="fontwhite"> ${title} </h2>
         //     <img src=${image} class="card-img-top" alt="dish_image">
         //     <p class="card-text">Cook Time:${cookingMinutes} </p>
         //     <p class="card-text">Instructions:</p>
         //     <p class="card-text"> 
         //         <a href=${sourceUrl} class="btn btn-primary button1">Go to source</a>
         //     </p>
         //   </div>
            var element = `
            <div class="grid-container">
             <div class="grid-item item1"><h2>${title}</h2></div>
             <div class="grid-item item2"><img src=${image} class="img1" width="460" height="345"></div>
             <div class="grid-item item3"><p class="pIngredient">Cook Time:${cookingMinutes} minutes </p><br>
              <p class="pIngredient">Ingredients:</p>
              </div>  
             <div class="grid-item item5"><p class="pIngredient">Instruction</p>
              <p class="pInstructions">${instructions}</p>
              <p class="card-text"> 
                  <a href=${sourceUrl} class="btn btn-primary button1" target="_blank">Go to source</a>
              </p>
              </div>
            </div>


          `;
          $("#resultDisplay").append(element);
        }
      })
    }
  })
</script>

</html>